import{d as ze,r as w,n as Le,p as Ee,L as Pe,c as v,o as i,i as m,D as k,H as h,B as I,b as a,w as o,e as g,C as je,I as U,J as L,q as B,E as _,g as E,M as N,j as C,x as P,v as W,N as ee,O as Te,P as le,Q as Be,_ as De}from"./index-DqKDKMSc.js";import{e as _e}from"./crypto-LaarjSnp.js";const Je={class:"servers-page"},Me={class:"page-header"},Oe={class:"expand-content"},Re={key:0,class:"edit-form-container"},qe={class:"server-url-input"},Ae={class:"url-row"},Fe={class:"url-row"},We={class:"task-configs-container"},Ke={class:"task-card-header"},Xe={class:"scantask-header"},He={class:"scantask-libraries"},Qe={class:"library-inputs"},Ge={class:"form-actions"},Ye={key:1,class:"error-container"},Ze={key:2,class:"loading-text"},Ie=["title"],Ne={key:1},el=["onClick"],ll={class:"server-card-title"},al={class:"server-name"},tl={class:"server-card-url"},ol={class:"server-card-actions"},nl={key:0,class:"expand-content"},sl={key:0,class:"edit-form-container"},ul={class:"server-url-input"},dl={class:"url-row"},rl={class:"url-row"},il={class:"task-configs-container"},ml={class:"task-card-header"},cl={class:"scantask-header"},pl={class:"scantask-libraries"},vl={class:"library-inputs"},yl={class:"form-actions"},fl={key:1,class:"error-container"},kl={key:2,class:"loading-text"},bl={class:"server-url-input"},Vl={class:"url-row"},_l={class:"url-row"},wl={class:"task-configs-container"},hl={class:"task-card-header"},gl={class:"scantask-header"},Ul={class:"scantask-libraries"},xl={class:"library-inputs"},Cl=ze({__name:"Servers",setup(Sl){const D=w([]),O=w(!1),R=w(!1),j=w(!1),ae=w(!1),te=w(),K=w({}),X=w({}),H=w({}),d=w({}),Q=w({}),u=w({name:"",type:"",protocol:"http",host:"",port:80,token:"",username:"",password:"",tasks:{}}),J=w({}),q=w({}),ce=w({}),A=w({}),G=w(!1),pe=async()=>{O.value=!0;try{D.value=await B.getServers()}catch(t){console.error("加载服务器列表失败:",t),_.error("加载服务器失败: "+t.message+"，请检查日志")}finally{O.value=!1}},ve=async t=>{try{const e=await B.testConnection(t.name);e.status==="success"?_.success(e.message):_.error((e.message||"连接测试失败")+"，请检查日志")}catch(e){console.error("测试连接失败:",e),_.error("测试连接失败: "+(e.message||"连接测试失败")+"，请检查日志")}},we=async()=>{if(!u.value.name||!u.value.type||!u.value.host||!u.value.port){_.error("请填写所有必填项（名称、类型、主机地址、端口）");return}G.value=!0;try{const t=`${u.value.protocol}://${u.value.host}:${u.value.port}`;let e=u.value.password;if(e)try{e=await _e(e)}catch(r){console.error("密码加密失败:",r),_.error("密码加密失败，请重试");return}const p={name:u.value.name,type:u.value.type,url:t,token:u.value.token,username:u.value.username,password:e,...u.value.tasks},n=await B.addServer(p);n.status==="success"?(_.success(n.message||"添加服务器成功"),await pe(),R.value=!1,u.value={name:"",type:"",protocol:"http",host:"",port:80,token:"",username:"",password:"",tasks:{}}):_.error(n.message||"添加服务器失败")}catch(t){console.error("添加服务器失败:",t),_.error("添加服务器失败: "+(t.message||"添加服务器失败")+"，请检查日志")}finally{G.value=!1}},ye=async t=>{try{await Be.confirm(`确定要删除服务器 "${t.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),H.value[t.name]=!0;try{const e=await B.deleteServer(t.name);e.status==="success"?(_.success(e.message),D.value=D.value.filter(p=>p.name!==t.name)):_.error(e.message||"删除失败")}finally{H.value[t.name]=!1}}catch(e){e!=="cancel"&&(console.error("删除服务器失败:",e),_.error("删除服务器失败: "+(e.message||"删除服务器失败")+"，请检查日志"))}},he=t=>{te.value&&te.value.toggleRowExpansion(t)},ge=async(t,e)=>{e.some(p=>p.name===t.name)&&!t.config&&Y(t)},Ue=t=>{Q.value[t.name]=!Q.value[t.name],Q.value[t.name]&&!t.config&&Y(t)},Y=async t=>{var e;K.value[t.name]=!0,X.value[t.name]=!1;try{const p=await B.getServerConfig(t.name);t.config=p;const n=JSON.parse(JSON.stringify(p));if(n.url)try{const r=new URL(n.url);n.protocol=r.protocol.replace(":",""),n.host=r.hostname,n.port=parseInt(r.port)||(r.protocol==="https:"?443:80)}catch(r){console.error("URL 解析失败:",r),n.protocol="http",n.host="",n.port=80}if(d.value[t.name]=n,(e=n.scantask)!=null&&e.library){const r=Object.entries(n.scantask.library).map(([c,y])=>({id:c,name:y.name}));J.value[t.name]=r}}catch(p){console.error("获取服务器配置失败:",p),_.error("获取服务器配置失败: "+p.message+"，请检查日志"),X.value[t.name]=!0}finally{K.value[t.name]=!1}},fe=async t=>{var p;const e=d.value[t.name];if(e){if(!e.name||!e.type||!e.host||!e.port){_.error("请填写所有必填项（名称、类型、主机地址、端口）");return}A.value[t.name]=!0;try{if(e.url=`${e.protocol}://${e.host}:${e.port}`,e.username||delete e.username,e.password)try{e.password=await _e(e.password)}catch(r){console.error("密码加密失败:",r),_.error("密码加密失败，请重试"),A.value[t.name]=!1;return}else delete e.password;if((p=e.scantask)!=null&&p.library){const r={};Object.entries(e.scantask.library).forEach(([c,y])=>{y.name&&!c.startsWith("temp_")&&(r[c]=y)}),e.scantask.library=r}const n=await B.updateServer(t.name,e);n.status==="success"?(t.name=e.name,t.type=e.type,t.url=e.url,t.config=JSON.parse(JSON.stringify(e)),d.value[e.name]=JSON.parse(JSON.stringify(e)),t.name!==e.name&&delete d.value[t.name],_.success("配置保存成功")):_.error(n.message||"保存失败")}catch(n){console.error("保存配置失败:",n),_.error("保存配置失败: "+(n.message||"保存配置失败")+"，请检查日志")}finally{A.value[t.name]=!1}}},oe=t=>({roletask:"演员本地化",sorttask:"标题排序",scantask:"库扫描",mergetask:"电影合并",titletask:"季度标题"})[t]||t,ke=(t,e)=>{const n={plex:["roletask","sorttask","scantask"],emby:["roletask","sorttask","scantask","mergetask","titletask"],jellyfin:["sorttask","scantask","mergetask","titletask"]}[t.toLowerCase()];return n?n.includes(e):!0},xe=t=>{const e={run:!1,crontab:"0 0 * * *"},n={plex:["roletask","sorttask","scantask"],emby:["roletask","sorttask","scantask","mergetask","titletask"],jellyfin:["sorttask","scantask","mergetask","titletask"]}[t.toLowerCase()]||[],r={};return n.forEach(c=>{c==="scantask"?r[c]={...e,library:{}}:r[c]={...e}}),r},be=t=>{var n,r;let e;if(d.value[t]?e=(n=d.value[t])==null?void 0:n.scantask:t===u.value.name&&(e=(r=u.value.tasks)==null?void 0:r.scantask),!e)return;e.library||(e.library={});const p=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e.library[p]={name:"",crontab:""}},ne=async t=>{if(!ce.value[t]){q.value[t]=!0;try{const e=await B.getServerLibraries(t);J.value[t]=e.libraries,ce.value[t]=!0}catch(e){console.error("加载服务器库列表失败:",e),_.error("加载库列表失败: "+e.message+"，请检查日志")}finally{q.value[t]=!1}}},se=(t,e,p)=>{var y,S,T;let n;if(d.value[t]?n=(y=d.value[t])==null?void 0:y.scantask:t===u.value.name&&(n=(S=u.value.tasks)==null?void 0:S.scantask),!n||!n.library||!n.library[e])return;const r=n.library[e],c=(T=J.value[t])==null?void 0:T.find(F=>F.id===p);c&&(delete n.library[e],n.library[p]={name:c.name,crontab:r.crontab})},ue=(t,e)=>{var n,r;let p;d.value[t]?p=(n=d.value[t])==null?void 0:n.scantask:t===u.value.name&&(p=(r=u.value.tasks)==null?void 0:r.scantask),!(!p||!p.library)&&delete p.library[e]},de=(t,e,p)=>{var r,c;let n;return d.value[t]?n=(r=d.value[t])==null?void 0:r.scantask:t===u.value.name&&(n=(c=u.value.tasks)==null?void 0:c.scantask),!(n!=null&&n.library)||p===e?!1:Object.keys(n.library).some(y=>y===e&&y!==p)},re=()=>{j.value=window.innerWidth<=600,ae.value=window.innerWidth<=980};return Le(()=>{pe(),re(),window.addEventListener("resize",re)}),Ee(()=>{window.removeEventListener("resize",re)}),Pe(()=>u.value.type,t=>{t&&(u.value.tasks=xe(t))}),(t,e)=>{const p=g("el-icon"),n=g("el-button"),r=g("el-input"),c=g("el-form-item"),y=g("el-option"),S=g("el-select"),T=g("el-input-number"),F=g("el-switch"),ie=g("el-form"),M=g("el-table-column"),me=g("el-tag"),$=g("el-tooltip"),Ce=g("el-table"),Ve=g("el-card"),Se=g("el-empty"),$e=g("el-dialog"),Z=je("loading");return i(),v("div",Je,[m("div",Me,[e[17]||(e[17]=m("h1",null,"服务器管理",-1)),a(n,{type:"primary",onClick:e[0]||(e[0]=l=>R.value=!0)},{default:o(()=>[a(p,null,{default:o(()=>[a(E(N))]),_:1}),e[16]||(e[16]=m("span",null,"添加服务器",-1))]),_:1})]),j.value?h("",!0):(i(),k(Ve,{key:0},{default:o(()=>[I((i(),k(Ce,{ref_key:"tableRef",ref:te,data:D.value,"row-key":"name",onExpandChange:ge,onRowClick:he},{default:o(()=>[a(M,{type:"expand"},{default:o(l=>[I((i(),v("div",Oe,[d.value[l.row.name]?(i(),v("div",Re,[a(ie,{model:d.value[l.row.name],"label-width":"100px"},{default:o(()=>[e[22]||(e[22]=m("h4",null,"基本配置",-1)),a(c,{label:"服务器名称"},{default:o(()=>[a(r,{modelValue:d.value[l.row.name].name,"onUpdate:modelValue":s=>d.value[l.row.name].name=s,placeholder:"不要重复"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(c,{label:"类型"},{default:o(()=>[a(S,{modelValue:d.value[l.row.name].type,"onUpdate:modelValue":s=>d.value[l.row.name].type=s},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(c,{label:"服务器地址"},{default:o(()=>[m("div",qe,[m("div",Ae,[a(S,{modelValue:d.value[l.row.name].protocol,"onUpdate:modelValue":s=>d.value[l.row.name].protocol=s,placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e[18]||(e[18]=m("span",{class:"url-separator"},"://",-1))]),a(r,{modelValue:d.value[l.row.name].host,"onUpdate:modelValue":s=>d.value[l.row.name].host=s,placeholder:"localhost 或 IP",class:"url-host"},null,8,["modelValue","onUpdate:modelValue"]),m("div",Fe,[e[19]||(e[19]=m("span",{class:"url-separator"},":",-1)),a(T,{modelValue:d.value[l.row.name].port,"onUpdate:modelValue":s=>d.value[l.row.name].port=s,min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024),a(c,{label:"访问令牌"},{default:o(()=>[a(r,{modelValue:d.value[l.row.name].token,"onUpdate:modelValue":s=>d.value[l.row.name].token=s,placeholder:"Plex必填，emby / jellyfin选填Api key"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d.value[l.row.name].type!="plex"?(i(),k(c,{key:0,label:"用户名"},{default:o(()=>[a(r,{modelValue:d.value[l.row.name].username,"onUpdate:modelValue":s=>d.value[l.row.name].username=s,placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),d.value[l.row.name].type!="plex"?(i(),k(c,{key:1,label:"密码"},{default:o(()=>[a(r,{modelValue:d.value[l.row.name].password,"onUpdate:modelValue":s=>d.value[l.row.name].password=s,type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),e[23]||(e[23]=m("h4",{style:{"margin-top":"20px"}},"任务配置",-1)),m("div",We,[(i(!0),v(U,null,L(d.value[l.row.name],(s,b)=>(i(),v(U,{key:b},[s&&typeof s=="object"&&"run"in s&&ke(d.value[l.row.name].type,String(b))?(i(),v("div",{key:0,class:W(["task-config-card",{"task-config-card-wide":b==="scantask"}])},[m("div",Ke,P(oe(String(b))),1),a(c,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:s.run,"onUpdate:modelValue":f=>s.run=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),b!=="scantask"?(i(),k(c,{key:0,label:"Crontab"},{default:o(()=>[a(r,{modelValue:s.crontab,"onUpdate:modelValue":f=>s.crontab=f,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),b==="scantask"?(i(),v(U,{key:1},[m("div",Xe,[a(n,{size:"small",type:"primary",icon:E(N),onClick:f=>be(l.row.name)},{default:o(()=>[...e[20]||(e[20]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon","onClick"])]),m("div",He,[(i(!0),v(U,null,L(s.library,(f,z,x)=>(i(),v("div",{key:x,class:"scantask-library-row"},[m("div",Qe,[a(S,{"model-value":f.name?z:"","onUpdate:modelValue":V=>se(l.row.name,z,V),onClick:V=>ne(l.row.name),loading:q.value[l.row.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(i(!0),v(U,null,L(J.value[l.row.name],V=>(i(),k(y,{key:V.id,label:V.name,value:V.id,disabled:de(l.row.name,V.id,z)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","onClick","loading"]),a(r,{modelValue:f.crontab,"onUpdate:modelValue":V=>f.crontab=V,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input",required:""},null,8,["modelValue","onUpdate:modelValue"])]),a(n,{size:"small",type:"danger",icon:E(le),circle:"",onClick:V=>ue(l.row.name,z)},null,8,["icon","onClick"])]))),128))])],64)):h("",!0)],2)):h("",!0)],64))),128))]),m("div",Ge,[a(n,{type:"primary",onClick:s=>fe(l.row),loading:A.value[l.row.name]},{default:o(()=>[...e[21]||(e[21]=[C("保存配置",-1)])]),_:1},8,["onClick","loading"])])]),_:2},1032,["model"])])):X.value[l.row.name]?(i(),v("div",Ye,[e[25]||(e[25]=m("div",{class:"error-text"},"加载失败",-1)),a(n,{type:"primary",round:"",onClick:s=>Y(l.row)},{default:o(()=>[...e[24]||(e[24]=[C(" 重新加载 ",-1)])]),_:1},8,["onClick"])])):(i(),v("div",Ze,"加载配置中..."))])),[[Z,K.value[l.row.name]]])]),_:1}),a(M,{prop:"name",label:"名称","min-width":"80"}),a(M,{prop:"type",label:"类型","min-width":"80"},{default:o(l=>[a(me,{type:"primary",size:"small"},{default:o(()=>[C(P(l.row.type.toUpperCase()),1)]),_:2},1024)]),_:1}),a(M,{prop:"url",label:"地址","min-width":"120","show-overflow-tooltip":""}),a(M,{prop:"status",label:"状态","min-width":"70",align:"center"},{default:o(l=>[a(me,{class:"status-tag",type:l.row.status==="connected"?"success":"danger"},{default:o(()=>[C(P(l.row.status==="connected"?"已连接":"离线"),1)]),_:2},1032,["type"]),m("span",{class:W(["status-dot",l.row.status==="connected"?"status-connected":"status-disconnected"]),title:l.row.status==="connected"?"已连接":"离线"},null,10,Ie)]),_:1}),a(M,{label:"操作","min-width":"150"},{default:o(l=>[a($,{content:"测试连接",placement:"top",disabled:!ae.value},{default:o(()=>[a(n,{size:"small",class:"action-button",onClick:ee(s=>ve(l.row),["stop"])},{default:o(()=>[a(p,null,{default:o(()=>[a(E(Te))]),_:1}),e[26]||(e[26]=m("span",{class:"button-text"},"测试连接",-1))]),_:1},8,["onClick"])]),_:2},1032,["disabled"]),a($,{content:"删除",placement:"top",disabled:!ae.value},{default:o(()=>[a(n,{size:"small",type:"danger",class:"action-button",onClick:ee(s=>ye(l.row),["stop"]),loading:H.value[l.row.name]},{default:o(()=>[a(p,null,{default:o(()=>[a(E(le))]),_:1}),e[27]||(e[27]=m("span",{class:"button-text"},"删除",-1))]),_:1},8,["onClick","loading"])]),_:2},1032,["disabled"])]),_:1})]),_:1},8,["data"])),[[Z,O.value]])]),_:1})),j.value?I((i(),v("div",Ne,[!O.value&&D.value.length===0?(i(),k(Se,{key:0,description:"暂无服务器"})):h("",!0),(i(!0),v(U,null,L(D.value,l=>(i(),k(Ve,{key:l.name,class:W(["server-card",l.status==="connected"?"server-card-connected":"server-card-disconnected"])},{default:o(()=>[m("div",{class:"server-card-content",onClick:s=>Ue(l)},[m("div",null,[m("div",ll,[m("span",al,P(l.name),1),a(me,{type:"primary",size:"small",style:{"margin-left":"8px"}},{default:o(()=>[C(P(l.type.toUpperCase()),1)]),_:2},1024)]),m("div",tl,P(l.url),1)]),m("div",ol,[a(n,{size:"small",onClick:ee(s=>ve(l),["stop"])},{default:o(()=>[...e[28]||(e[28]=[C("测试连接",-1)])]),_:1},8,["onClick"]),a(n,{size:"small",type:"danger",onClick:ee(s=>ye(l),["stop"]),loading:H.value[l.name]},{default:o(()=>[...e[29]||(e[29]=[C("删除",-1)])]),_:1},8,["onClick","loading"])])],8,el),Q.value[l.name]?I((i(),v("div",nl,[d.value[l.name]?(i(),v("div",sl,[a(ie,{model:d.value[l.name],"label-width":"100px"},{default:o(()=>[e[34]||(e[34]=m("h4",null,"基本配置",-1)),a(c,{label:"服务器名称",required:""},{default:o(()=>[a(r,{modelValue:d.value[l.name].name,"onUpdate:modelValue":s=>d.value[l.name].name=s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(c,{label:"类型"},{default:o(()=>[a(S,{modelValue:d.value[l.name].type,"onUpdate:modelValue":s=>d.value[l.name].type=s},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(c,{label:"服务器地址"},{default:o(()=>[m("div",ul,[m("div",dl,[a($,{content:"选择协议类型",placement:"top"},{default:o(()=>[a(S,{modelValue:d.value[l.name].protocol,"onUpdate:modelValue":s=>d.value[l.name].protocol=s,placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e[30]||(e[30]=m("span",{class:"url-separator"},"://",-1))]),a($,{content:"输入服务器地址，例如：localhost 或 192.168.1.100",placement:"top"},{default:o(()=>[a(r,{modelValue:d.value[l.name].host,"onUpdate:modelValue":s=>d.value[l.name].host=s,placeholder:"地址",class:"url-host"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),m("div",rl,[e[31]||(e[31]=m("span",{class:"url-separator"},":",-1)),a($,{content:"输入端口号（1-65535）",placement:"top"},{default:o(()=>[a(T,{modelValue:d.value[l.name].port,"onUpdate:modelValue":s=>d.value[l.name].port=s,min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])])]),_:2},1024),a(c,{label:"访问令牌"},{default:o(()=>[a($,{content:"Plex 必须填写 X-Plex-Token，Emby/Jellyfin 填写 API Key",placement:"top"},{default:o(()=>[a(r,{modelValue:d.value[l.name].token,"onUpdate:modelValue":s=>d.value[l.name].token=s,placeholder:"令牌"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),d.value[l.name].type!="plex"?(i(),k(c,{key:0,label:"用户名"},{default:o(()=>[a(r,{modelValue:d.value[l.name].username,"onUpdate:modelValue":s=>d.value[l.name].username=s,placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),d.value[l.name].type!="plex"?(i(),k(c,{key:1,label:"密码"},{default:o(()=>[a(r,{modelValue:d.value[l.name].password,"onUpdate:modelValue":s=>d.value[l.name].password=s,type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),e[35]||(e[35]=m("h4",{style:{"margin-top":"20px"}},"任务配置",-1)),m("div",il,[(i(!0),v(U,null,L(d.value[l.name],(s,b)=>(i(),v(U,{key:b},[s&&typeof s=="object"&&"run"in s&&ke(d.value[l.name].type,String(b))?(i(),v("div",{key:0,class:W(["task-config-card",{"task-config-card-wide":b==="scantask"}])},[m("div",ml,P(oe(String(b))),1),a(c,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:s.run,"onUpdate:modelValue":f=>s.run=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),b!=="scantask"?(i(),k(c,{key:0,label:"Crontab"},{default:o(()=>[a(r,{modelValue:s.crontab,"onUpdate:modelValue":f=>s.crontab=f,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),b==="scantask"?(i(),v(U,{key:1},[m("div",cl,[a(n,{size:"small",type:"primary",icon:E(N),onClick:f=>be(l.name)},{default:o(()=>[...e[32]||(e[32]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon","onClick"])]),m("div",pl,[(i(!0),v(U,null,L(s.library,(f,z,x)=>(i(),v("div",{key:x,class:"scantask-library-row"},[m("div",vl,[a(S,{"model-value":f.name?z:"","onUpdate:modelValue":V=>se(l.name,z,V),onClick:V=>ne(l.name),loading:q.value[l.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(i(!0),v(U,null,L(J.value[l.name],V=>(i(),k(y,{key:V.id,label:V.name,value:V.id,disabled:de(l.name,V.id,z)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","onClick","loading"]),a(r,{modelValue:f.crontab,"onUpdate:modelValue":V=>f.crontab=V,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input"},null,8,["modelValue","onUpdate:modelValue"])]),a(n,{size:"small",type:"danger",icon:E(le),circle:"",onClick:V=>ue(l.name,z)},null,8,["icon","onClick"])]))),128))])],64)):h("",!0)],2)):h("",!0)],64))),128))]),m("div",yl,[a(n,{type:"primary",onClick:s=>fe(l),loading:A.value[l.name]},{default:o(()=>[...e[33]||(e[33]=[C("保存配置",-1)])]),_:1},8,["onClick","loading"])])]),_:2},1032,["model"])])):X.value[l.name]?(i(),v("div",fl,[e[37]||(e[37]=m("div",{class:"error-text"},"加载失败",-1)),a(n,{type:"primary",round:"",onClick:s=>Y(l)},{default:o(()=>[...e[36]||(e[36]=[C(" 重新加载 ",-1)])]),_:1},8,["onClick"])])):(i(),v("div",kl,"加载配置中..."))])),[[Z,K.value[l.name]]]):h("",!0)]),_:2},1032,["class"]))),128))])),[[Z,O.value]]):h("",!0),a($e,{modelValue:R.value,"onUpdate:modelValue":e[15]||(e[15]=l=>R.value=l),title:"添加服务器",width:"600px",center:"",class:"server-dialog"},{footer:o(()=>[a(n,{onClick:e[14]||(e[14]=l=>R.value=!1),disabled:G.value},{default:o(()=>[...e[42]||(e[42]=[C("取消",-1)])]),_:1},8,["disabled"]),a(n,{type:"primary",onClick:we,loading:G.value},{default:o(()=>[...e[43]||(e[43]=[C("添加",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(ie,{model:u.value,"label-width":"100px"},{default:o(()=>[a(c,{label:"服务器名称",required:""},{default:o(()=>[a(r,{modelValue:u.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.name=l),placeholder:"请输入服务器名称"},null,8,["modelValue"])]),_:1}),a(c,{label:"服务器类型",required:""},{default:o(()=>[a(S,{modelValue:u.value.type,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.type=l),placeholder:"选择服务器类型",class:"server-type-select"},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"服务器地址",required:""},{default:o(()=>[m("div",bl,[m("div",Vl,[j.value?(i(),k($,{key:0,content:"选择协议类型",placement:"top"},{default:o(()=>[a(S,{modelValue:u.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.protocol=l),placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue"])]),_:1})):(i(),k(S,{key:1,modelValue:u.value.protocol,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.protocol=l),placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue"])),e[38]||(e[38]=m("span",{class:"url-separator"},"://",-1))]),j.value?(i(),k($,{key:0,content:"输入服务器地址，例如：localhost 或 192.168.1.100",placement:"top"},{default:o(()=>[a(r,{modelValue:u.value.host,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.host=l),placeholder:"地址",class:"url-host"},null,8,["modelValue"])]),_:1})):(i(),k(r,{key:1,modelValue:u.value.host,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.host=l),placeholder:"localhost 或 IP",class:"url-host"},null,8,["modelValue"])),m("div",_l,[e[39]||(e[39]=m("span",{class:"url-separator"},":",-1)),j.value?(i(),k($,{key:0,content:"输入端口号（1-65535）",placement:"top"},{default:o(()=>[a(T,{modelValue:u.value.port,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value.port=l),min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue"])]),_:1})):(i(),k(T,{key:1,modelValue:u.value.port,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value.port=l),min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue"]))])])]),_:1}),a(c,{label:"访问令牌"},{default:o(()=>[j.value?(i(),k($,{key:0,content:"Plex 必须填写 X-Plex-Token，Emby/Jellyfin 填写 API Key",placement:"top"},{default:o(()=>[a(r,{modelValue:u.value.token,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.token=l),placeholder:"令牌"},null,8,["modelValue"])]),_:1})):(i(),k(r,{key:1,modelValue:u.value.token,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.token=l),placeholder:"Plex必填，emby / jellyfin选填Api key"},null,8,["modelValue"]))]),_:1}),a(c,{label:"用户名"},{default:o(()=>[a(r,{modelValue:u.value.username,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.username=l),placeholder:"可选"},null,8,["modelValue"])]),_:1}),a(c,{label:"密码"},{default:o(()=>[a(r,{modelValue:u.value.password,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.password=l),type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue"])]),_:1}),u.value.type?(i(),v(U,{key:0},[e[41]||(e[41]=m("h4",{style:{"margin-top":"20px","margin-bottom":"16px"}},"任务配置",-1)),m("div",wl,[(i(!0),v(U,null,L(u.value.tasks,(l,s)=>(i(),v("div",{key:s,class:W(["task-config-card",{"task-config-card-wide":s==="scantask"}])},[m("div",hl,P(oe(String(s))),1),a(c,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:l.run,"onUpdate:modelValue":b=>l.run=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s!=="scantask"?(i(),k(c,{key:0,label:"Crontab"},{default:o(()=>[a(r,{modelValue:l.crontab,"onUpdate:modelValue":b=>l.crontab=b,size:"small",placeholder:"如: 0 0 * * *"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):h("",!0),s==="scantask"?(i(),v(U,{key:1},[m("div",gl,[a($,{content:"请先保存服务器后再配置库扫描",placement:"top"},{default:o(()=>[a(n,{size:"small",type:"primary",icon:E(N),disabled:""},{default:o(()=>[...e[40]||(e[40]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon"])]),_:1})]),m("div",Ul,[(i(!0),v(U,null,L(l.library,(b,f,z)=>(i(),v("div",{key:z,class:"scantask-library-row"},[m("div",xl,[a(S,{"model-value":b.name?f:"","onUpdate:modelValue":x=>se(u.value.name,f,x),onClick:e[13]||(e[13]=x=>ne(u.value.name)),loading:q.value[u.value.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(i(!0),v(U,null,L(J.value[u.value.name],x=>(i(),k(y,{key:x.id,label:x.name,value:x.id,disabled:de(u.value.name,x.id,f)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","loading"]),a(r,{modelValue:b.crontab,"onUpdate:modelValue":x=>b.crontab=x,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input"},null,8,["modelValue","onUpdate:modelValue"])]),a(n,{size:"small",type:"danger",icon:E(le),circle:"",onClick:x=>ue(u.value.name,f)},null,8,["icon","onClick"])]))),128))])],64)):h("",!0)],2))),128))])],64)):h("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ll=De(Cl,[["__scopeId","data-v-2e888408"]]);export{Ll as default};
