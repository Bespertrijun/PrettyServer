import{d as h,r as w,a as k,c as z,o as F,b as o,w as s,e as l,u as P,f,g as _,h as A,l as y,i as p,j as K,k as q,E as i,_ as B}from"./index--47v_MsL.js";import{e as E}from"./crypto-238bpgeP.js";const L={class:"login-container"},N=h({__name:"Login",setup(R){const v=P(),m=w(),c=w(!1),t=k({username:"",password:"",totpCode:""}),V={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},d=async()=>{m.value&&await m.value.validate(async g=>{if(g){c.value=!0;try{const e=await E(t.password),r={username:t.username,password:e};t.totpCode&&(r.totp_code=t.totpCode);const a=await q.login(r);a.status==="success"?(i.success("登录成功"),v.push("/")):a.status==="require_2fa"?i.warning(a.message||"请输入2FA验证码"):i.error(a.message||"登录失败，请检查用户名和密码，请检查日志")}catch(e){console.error("登录失败:",e),i.error("登录失败: "+e.message)}finally{c.value=!1}}})};return(g,e)=>{const r=l("el-icon"),a=l("el-input"),u=l("el-form-item"),x=l("el-button"),C=l("el-form"),b=l("el-card");return F(),z("div",L,[o(b,{class:"login-card"},{header:s(()=>[...e[3]||(e[3]=[p("div",{class:"card-header"},[p("h2",null,"PrettyServer"),p("p",null,"媒体服务器管理工具")],-1)])]),default:s(()=>[o(C,{model:t,rules:V,ref_key:"loginFormRef",ref:m,"label-width":"0"},{default:s(()=>[o(u,{prop:"username"},{default:s(()=>[o(a,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=n=>t.username=n),placeholder:"用户名",size:"large",clearable:"",onKeyup:f(d,["enter"])},{prefix:s(()=>[o(r,null,{default:s(()=>[o(_(A))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(u,{prop:"password"},{default:s(()=>[o(a,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=n=>t.password=n),type:"password",placeholder:"密码",size:"large","show-password":"",onKeyup:f(d,["enter"])},{prefix:s(()=>[o(r,null,{default:s(()=>[o(_(y))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(u,{prop:"totpCode"},{default:s(()=>[o(a,{modelValue:t.totpCode,"onUpdate:modelValue":e[2]||(e[2]=n=>t.totpCode=n),placeholder:"2FA",size:"large",maxlength:"6",onKeyup:f(d,["enter"])},{prefix:s(()=>[o(r,null,{default:s(()=>[o(_(y))]),_:1})]),_:1},8,["modelValue"]),e[4]||(e[4]=p("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," 如果启用了双因素认证，请输入认证器 APP 中的 6 位验证码 ",-1))]),_:1}),o(u,null,{default:s(()=>[o(x,{type:"primary",size:"large",loading:c.value,onClick:d,style:{width:"100%"}},{default:s(()=>[...e[5]||(e[5]=[K(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),I=B(N,[["__scopeId","data-v-c515f42e"]]);export{I as default};
