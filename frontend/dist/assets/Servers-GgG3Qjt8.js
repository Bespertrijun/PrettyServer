import{d as $e,r as g,n as ze,p as Ee,L as Le,c as v,o as r,i,D as V,H as w,B as I,b as a,w as o,e as h,C as Pe,I as U,J as E,q as B,E as _,g as L,M as N,j as C,x as P,v as W,N as ee,O as Te,P as le,Q as je,_ as Be}from"./index-CW49KeDn.js";import{e as be}from"./crypto-DYYNj6SL.js";const De={class:"servers-page"},Je={class:"page-header"},Me={class:"expand-content"},Oe={key:0,class:"edit-form-container"},Re={class:"server-url-input"},qe={class:"url-row"},Ae={class:"url-row"},Fe={class:"task-configs-container"},We={class:"task-card-header"},Ke={class:"scantask-header"},Xe={class:"scantask-libraries"},He={class:"form-actions"},Qe={key:1,class:"error-container"},Ge={key:2,class:"loading-text"},Ye=["title"],Ze={key:1},Ie=["onClick"],Ne={class:"server-card-title"},el={class:"server-name"},ll={class:"server-card-url"},al={class:"server-card-actions"},tl={key:0,class:"expand-content"},ol={key:0,class:"edit-form-container"},nl={class:"server-url-input"},sl={class:"url-row"},ul={class:"url-row"},dl={class:"task-configs-container"},rl={class:"task-card-header"},il={class:"scantask-header"},ml={class:"scantask-libraries"},cl={class:"form-actions"},pl={key:1,class:"error-container"},vl={key:2,class:"loading-text"},yl={class:"server-url-input"},fl={class:"url-row"},kl={class:"url-row"},Vl={class:"task-configs-container"},bl={class:"task-card-header"},_l={class:"scantask-header"},wl={class:"scantask-libraries"},gl=$e({__name:"Servers",setup(hl){const D=g([]),O=g(!1),R=g(!1),T=g(!1),ae=g(!1),te=g(),K=g({}),X=g({}),H=g({}),d=g({}),Q=g({}),u=g({name:"",type:"",protocol:"http",host:"",port:80,token:"",username:"",password:"",tasks:{}}),J=g({}),q=g({}),A=g({}),G=g(!1),pe=async()=>{O.value=!0;try{D.value=await B.getServers()}catch(t){console.error("加载服务器列表失败:",t),_.error("加载服务器失败: "+t.message+"，请检查日志")}finally{O.value=!1}},ve=async t=>{try{const e=await B.testConnection(t.name);e.status==="success"?_.success(e.message):_.error((e.message||"连接测试失败")+"，请检查日志")}catch(e){console.error("测试连接失败:",e),_.error("测试连接失败: "+(e.message||"连接测试失败")+"，请检查日志")}},_e=async()=>{if(!u.value.name||!u.value.type||!u.value.host||!u.value.port){_.error("请填写所有必填项（名称、类型、主机地址、端口）");return}G.value=!0;try{const t=`${u.value.protocol}://${u.value.host}:${u.value.port}`;let e=u.value.password;if(e)try{e=await be(e)}catch(m){console.error("密码加密失败:",m),_.error("密码加密失败，请重试");return}const c={name:u.value.name,type:u.value.type,url:t,token:u.value.token,username:u.value.username,password:e,...u.value.tasks},s=await B.addServer(c);s.status==="success"?(_.success(s.message||"添加服务器成功"),await pe(),R.value=!1,u.value={name:"",type:"",protocol:"http",host:"",port:80,token:"",username:"",password:"",tasks:{}}):_.error(s.message||"添加服务器失败")}catch(t){console.error("添加服务器失败:",t),_.error("添加服务器失败: "+(t.message||"添加服务器失败")+"，请检查日志")}finally{G.value=!1}},ye=async t=>{try{await je.confirm(`确定要删除服务器 "${t.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),H.value[t.name]=!0;try{const e=await B.deleteServer(t.name);e.status==="success"?(_.success(e.message),D.value=D.value.filter(c=>c.name!==t.name)):_.error(e.message||"删除失败")}finally{H.value[t.name]=!1}}catch(e){e!=="cancel"&&(console.error("删除服务器失败:",e),_.error("删除服务器失败: "+(e.message||"删除服务器失败")+"，请检查日志"))}},we=t=>{te.value&&te.value.toggleRowExpansion(t)},ge=async(t,e)=>{e.some(c=>c.name===t.name)&&!t.config&&Y(t)},he=t=>{Q.value[t.name]=!Q.value[t.name],Q.value[t.name]&&!t.config&&Y(t)},Y=async t=>{K.value[t.name]=!0,X.value[t.name]=!1;try{const e=await B.getServerConfig(t.name);t.config=e;const c=JSON.parse(JSON.stringify(e));if(c.url)try{const s=new URL(c.url);c.protocol=s.protocol.replace(":",""),c.host=s.hostname,c.port=parseInt(s.port)||(s.protocol==="https:"?443:80)}catch(s){console.error("URL 解析失败:",s),c.protocol="http",c.host="",c.port=80}d.value[t.name]=c}catch(e){console.error("获取服务器配置失败:",e),_.error("获取服务器配置失败: "+e.message+"，请检查日志"),X.value[t.name]=!0}finally{K.value[t.name]=!1}},fe=async t=>{var c;const e=d.value[t.name];if(e){if(!e.name||!e.type||!e.host||!e.port){_.error("请填写所有必填项（名称、类型、主机地址、端口）");return}A.value[t.name]=!0;try{if(e.url=`${e.protocol}://${e.host}:${e.port}`,e.password)try{e.password=await be(e.password)}catch(m){console.error("密码加密失败:",m),_.error("密码加密失败，请重试"),A.value[t.name]=!1;return}if((c=e.scantask)!=null&&c.library){const m={};Object.entries(e.scantask.library).forEach(([p,y])=>{y.name&&!p.startsWith("temp_")&&(m[p]=y)}),e.scantask.library=m}const s=await B.updateServer(t.name,e);s.status==="success"?(t.name=e.name,t.type=e.type,t.url=e.url,t.config=JSON.parse(JSON.stringify(e)),d.value[e.name]=JSON.parse(JSON.stringify(e)),t.name!==e.name&&delete d.value[t.name],_.success("配置保存成功")):_.error(s.message||"保存失败")}catch(s){console.error("保存配置失败:",s),_.error("保存配置失败: "+(s.message||"保存配置失败")+"，请检查日志")}finally{A.value[t.name]=!1}}},oe=t=>({roletask:"演员本地化",sorttask:"标题排序",scantask:"库扫描",mergetask:"电影合并",titletask:"季度标题"})[t]||t,ke=(t,e)=>{const s={plex:["roletask","sorttask","scantask"],emby:["roletask","sorttask","scantask","mergetask","titletask"],jellyfin:["sorttask","scantask","mergetask","titletask"]}[t.toLowerCase()];return s?s.includes(e):!0},Ue=t=>{const e={run:!1,crontab:"0 0 * * *"},s={plex:["roletask","sorttask","scantask"],emby:["roletask","sorttask","scantask","mergetask","titletask"],jellyfin:["sorttask","scantask","mergetask","titletask"]}[t.toLowerCase()]||[],m={};return s.forEach(p=>{p==="scantask"?m[p]={...e,library:{}}:m[p]={...e}}),m},ne=t=>{var s,m;let e;if(d.value[t]?e=(s=d.value[t])==null?void 0:s.scantask:t===u.value.name&&(e=(m=u.value.tasks)==null?void 0:m.scantask),!e)return;e.library||(e.library={});const c=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e.library[c]={name:"",crontab:""}},se=async t=>{if(!J.value[t]){q.value[t]=!0;try{const e=await B.getServerLibraries(t);J.value[t]=e.libraries}catch(e){console.error("加载服务器库列表失败:",e),_.error("加载库列表失败: "+e.message+"，请检查日志")}finally{q.value[t]=!1}}},ue=(t,e,c)=>{var y,S,j;let s;if(d.value[t]?s=(y=d.value[t])==null?void 0:y.scantask:t===u.value.name&&(s=(S=u.value.tasks)==null?void 0:S.scantask),!s||!s.library||!s.library[e])return;const m=s.library[e],p=(j=J.value[t])==null?void 0:j.find(F=>F.id===c);p&&(delete s.library[e],s.library[c]={name:p.name,crontab:m.crontab})},de=(t,e)=>{var s,m;let c;d.value[t]?c=(s=d.value[t])==null?void 0:s.scantask:t===u.value.name&&(c=(m=u.value.tasks)==null?void 0:m.scantask),!(!c||!c.library)&&delete c.library[e]},re=(t,e,c)=>{var m,p;let s;return d.value[t]?s=(m=d.value[t])==null?void 0:m.scantask:t===u.value.name&&(s=(p=u.value.tasks)==null?void 0:p.scantask),!(s!=null&&s.library)||c===e?!1:Object.keys(s.library).some(y=>y===e&&y!==c)},ie=()=>{T.value=window.innerWidth<=600,ae.value=window.innerWidth<=980};return ze(()=>{pe(),ie(),window.addEventListener("resize",ie)}),Ee(()=>{window.removeEventListener("resize",ie)}),Le(()=>u.value.type,t=>{t&&(u.value.tasks=Ue(t))}),(t,e)=>{const c=h("el-icon"),s=h("el-button"),m=h("el-input"),p=h("el-form-item"),y=h("el-option"),S=h("el-select"),j=h("el-input-number"),F=h("el-switch"),me=h("el-form"),M=h("el-table-column"),ce=h("el-tag"),z=h("el-tooltip"),xe=h("el-table"),Ve=h("el-card"),Ce=h("el-empty"),Se=h("el-dialog"),Z=Pe("loading");return r(),v("div",De,[i("div",Je,[e[18]||(e[18]=i("h1",null,"服务器管理",-1)),a(s,{type:"primary",onClick:e[0]||(e[0]=l=>R.value=!0)},{default:o(()=>[a(c,null,{default:o(()=>[a(L(N))]),_:1}),e[17]||(e[17]=i("span",null,"添加服务器",-1))]),_:1})]),T.value?w("",!0):(r(),V(Ve,{key:0},{default:o(()=>[I((r(),V(xe,{ref_key:"tableRef",ref:te,data:D.value,"row-key":"name",onExpandChange:ge,onRowClick:we},{default:o(()=>[a(M,{type:"expand"},{default:o(l=>[I((r(),v("div",Me,[d.value[l.row.name]?(r(),v("div",Oe,[a(me,{model:d.value[l.row.name],"label-width":"100px"},{default:o(()=>[e[23]||(e[23]=i("h4",null,"基本配置",-1)),a(p,{label:"服务器名称"},{default:o(()=>[a(m,{modelValue:d.value[l.row.name].name,"onUpdate:modelValue":n=>d.value[l.row.name].name=n,placeholder:"不要重复"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{label:"类型"},{default:o(()=>[a(S,{modelValue:d.value[l.row.name].type,"onUpdate:modelValue":n=>d.value[l.row.name].type=n},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{label:"服务器地址"},{default:o(()=>[i("div",Re,[i("div",qe,[a(S,{modelValue:d.value[l.row.name].protocol,"onUpdate:modelValue":n=>d.value[l.row.name].protocol=n,placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e[19]||(e[19]=i("span",{class:"url-separator"},"://",-1))]),a(m,{modelValue:d.value[l.row.name].host,"onUpdate:modelValue":n=>d.value[l.row.name].host=n,placeholder:"localhost 或 IP",class:"url-host"},null,8,["modelValue","onUpdate:modelValue"]),i("div",Ae,[e[20]||(e[20]=i("span",{class:"url-separator"},":",-1)),a(j,{modelValue:d.value[l.row.name].port,"onUpdate:modelValue":n=>d.value[l.row.name].port=n,min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024),a(p,{label:"访问令牌"},{default:o(()=>[a(m,{modelValue:d.value[l.row.name].token,"onUpdate:modelValue":n=>d.value[l.row.name].token=n,placeholder:"Plex必填，emby / jellyfin选填Api key"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d.value[l.row.name].type!="plex"?(r(),V(p,{key:0,label:"用户名"},{default:o(()=>[a(m,{modelValue:d.value[l.row.name].username,"onUpdate:modelValue":n=>d.value[l.row.name].username=n,placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),d.value[l.row.name].type!="plex"?(r(),V(p,{key:1,label:"密码"},{default:o(()=>[a(m,{modelValue:d.value[l.row.name].password,"onUpdate:modelValue":n=>d.value[l.row.name].password=n,type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),e[24]||(e[24]=i("h4",{style:{"margin-top":"20px"}},"任务配置",-1)),i("div",Fe,[(r(!0),v(U,null,E(d.value[l.row.name],(n,f)=>(r(),v(U,{key:f},[n&&typeof n=="object"&&"run"in n&&ke(d.value[l.row.name].type,String(f))?(r(),v("div",{key:0,class:W(["task-config-card",{"task-config-card-wide":f==="scantask"}])},[i("div",We,P(oe(String(f))),1),a(p,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:n.run,"onUpdate:modelValue":k=>n.run=k},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),f!=="scantask"?(r(),V(p,{key:0,label:"Crontab"},{default:o(()=>[a(m,{modelValue:n.crontab,"onUpdate:modelValue":k=>n.crontab=k,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),f==="scantask"?(r(),v(U,{key:1},[i("div",Ke,[a(s,{size:"small",type:"primary",icon:L(N),onClick:k=>ne(l.row.name)},{default:o(()=>[...e[21]||(e[21]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon","onClick"])]),i("div",Xe,[(r(!0),v(U,null,E(n.library,(k,$,x)=>(r(),v("div",{key:x,class:"scantask-library-row"},[a(S,{"model-value":k.name?$:"","onUpdate:modelValue":b=>ue(l.row.name,$,b),onClick:b=>se(l.row.name),loading:q.value[l.row.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(r(!0),v(U,null,E(J.value[l.row.name],b=>(r(),V(y,{key:b.id,label:b.name,value:b.id,disabled:re(l.row.name,b.id,$)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","onClick","loading"]),a(m,{modelValue:k.crontab,"onUpdate:modelValue":b=>k.crontab=b,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input",required:""},null,8,["modelValue","onUpdate:modelValue"]),a(s,{size:"small",type:"danger",icon:L(le),circle:"",onClick:b=>de(l.row.name,$)},null,8,["icon","onClick"])]))),128))])],64)):w("",!0)],2)):w("",!0)],64))),128))]),i("div",He,[a(s,{type:"primary",onClick:n=>fe(l.row),loading:A.value[l.row.name]},{default:o(()=>[...e[22]||(e[22]=[C("保存配置",-1)])]),_:1},8,["onClick","loading"])])]),_:2},1032,["model"])])):X.value[l.row.name]?(r(),v("div",Qe,[e[26]||(e[26]=i("div",{class:"error-text"},"加载失败",-1)),a(s,{type:"primary",round:"",onClick:n=>Y(l.row)},{default:o(()=>[...e[25]||(e[25]=[C(" 重新加载 ",-1)])]),_:1},8,["onClick"])])):(r(),v("div",Ge,"加载配置中..."))])),[[Z,K.value[l.row.name]]])]),_:1}),a(M,{prop:"name",label:"名称","min-width":"80"}),a(M,{prop:"type",label:"类型","min-width":"80"},{default:o(l=>[a(ce,{type:"primary",size:"small"},{default:o(()=>[C(P(l.row.type.toUpperCase()),1)]),_:2},1024)]),_:1}),a(M,{prop:"url",label:"地址","min-width":"120","show-overflow-tooltip":""}),a(M,{prop:"status",label:"状态","min-width":"70",align:"center"},{default:o(l=>[a(ce,{class:"status-tag",type:l.row.status==="connected"?"success":"danger"},{default:o(()=>[C(P(l.row.status==="connected"?"已连接":"离线"),1)]),_:2},1032,["type"]),i("span",{class:W(["status-dot",l.row.status==="connected"?"status-connected":"status-disconnected"]),title:l.row.status==="connected"?"已连接":"离线"},null,10,Ye)]),_:1}),a(M,{label:"操作","min-width":"150"},{default:o(l=>[a(z,{content:"测试连接",placement:"top",disabled:!ae.value},{default:o(()=>[a(s,{size:"small",class:"action-button",onClick:ee(n=>ve(l.row),["stop"])},{default:o(()=>[a(c,null,{default:o(()=>[a(L(Te))]),_:1}),e[27]||(e[27]=i("span",{class:"button-text"},"测试连接",-1))]),_:1},8,["onClick"])]),_:2},1032,["disabled"]),a(z,{content:"删除",placement:"top",disabled:!ae.value},{default:o(()=>[a(s,{size:"small",type:"danger",class:"action-button",onClick:ee(n=>ye(l.row),["stop"]),loading:H.value[l.row.name]},{default:o(()=>[a(c,null,{default:o(()=>[a(L(le))]),_:1}),e[28]||(e[28]=i("span",{class:"button-text"},"删除",-1))]),_:1},8,["onClick","loading"])]),_:2},1032,["disabled"])]),_:1})]),_:1},8,["data"])),[[Z,O.value]])]),_:1})),T.value?I((r(),v("div",Ze,[!O.value&&D.value.length===0?(r(),V(Ce,{key:0,description:"暂无服务器"})):w("",!0),(r(!0),v(U,null,E(D.value,l=>(r(),V(Ve,{key:l.name,class:W(["server-card",l.status==="connected"?"server-card-connected":"server-card-disconnected"])},{default:o(()=>[i("div",{class:"server-card-content",onClick:n=>he(l)},[i("div",null,[i("div",Ne,[i("span",el,P(l.name),1),a(ce,{type:"primary",size:"small",style:{"margin-left":"8px"}},{default:o(()=>[C(P(l.type.toUpperCase()),1)]),_:2},1024)]),i("div",ll,P(l.url),1)]),i("div",al,[a(s,{size:"small",onClick:ee(n=>ve(l),["stop"])},{default:o(()=>[...e[29]||(e[29]=[C("测试连接",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"danger",onClick:ee(n=>ye(l),["stop"]),loading:H.value[l.name]},{default:o(()=>[...e[30]||(e[30]=[C("删除",-1)])]),_:1},8,["onClick","loading"])])],8,Ie),Q.value[l.name]?I((r(),v("div",tl,[d.value[l.name]?(r(),v("div",ol,[a(me,{model:d.value[l.name],"label-width":"100px"},{default:o(()=>[e[35]||(e[35]=i("h4",null,"基本配置",-1)),a(p,{label:"服务器名称",required:""},{default:o(()=>[a(m,{modelValue:d.value[l.name].name,"onUpdate:modelValue":n=>d.value[l.name].name=n},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{label:"类型"},{default:o(()=>[a(S,{modelValue:d.value[l.name].type,"onUpdate:modelValue":n=>d.value[l.name].type=n},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{label:"服务器地址"},{default:o(()=>[i("div",nl,[i("div",sl,[a(z,{content:"选择协议类型",placement:"top"},{default:o(()=>[a(S,{modelValue:d.value[l.name].protocol,"onUpdate:modelValue":n=>d.value[l.name].protocol=n,placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e[31]||(e[31]=i("span",{class:"url-separator"},"://",-1))]),a(z,{content:"输入服务器地址，例如：localhost 或 192.168.1.100",placement:"top"},{default:o(()=>[a(m,{modelValue:d.value[l.name].host,"onUpdate:modelValue":n=>d.value[l.name].host=n,placeholder:"地址",class:"url-host"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i("div",ul,[e[32]||(e[32]=i("span",{class:"url-separator"},":",-1)),a(z,{content:"输入端口号（1-65535）",placement:"top"},{default:o(()=>[a(j,{modelValue:d.value[l.name].port,"onUpdate:modelValue":n=>d.value[l.name].port=n,min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])])]),_:2},1024),a(p,{label:"访问令牌"},{default:o(()=>[a(z,{content:"Plex 必须填写 X-Plex-Token，Emby/Jellyfin 填写 API Key",placement:"top"},{default:o(()=>[a(m,{modelValue:d.value[l.name].token,"onUpdate:modelValue":n=>d.value[l.name].token=n,placeholder:"令牌"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),d.value[l.name].type!="plex"?(r(),V(p,{key:0,label:"用户名"},{default:o(()=>[a(m,{modelValue:d.value[l.name].username,"onUpdate:modelValue":n=>d.value[l.name].username=n,placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),d.value[l.name].type!="plex"?(r(),V(p,{key:1,label:"密码"},{default:o(()=>[a(m,{modelValue:d.value[l.name].password,"onUpdate:modelValue":n=>d.value[l.name].password=n,type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),e[36]||(e[36]=i("h4",{style:{"margin-top":"20px"}},"任务配置",-1)),i("div",dl,[(r(!0),v(U,null,E(d.value[l.name],(n,f)=>(r(),v(U,{key:f},[n&&typeof n=="object"&&"run"in n&&ke(d.value[l.name].type,String(f))?(r(),v("div",{key:0,class:W(["task-config-card",{"task-config-card-wide":f==="scantask"}])},[i("div",rl,P(oe(String(f))),1),a(p,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:n.run,"onUpdate:modelValue":k=>n.run=k},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),f!=="scantask"?(r(),V(p,{key:0,label:"Crontab"},{default:o(()=>[a(m,{modelValue:n.crontab,"onUpdate:modelValue":k=>n.crontab=k,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),f==="scantask"?(r(),v(U,{key:1},[i("div",il,[a(s,{size:"small",type:"primary",icon:L(N),onClick:k=>ne(l.name)},{default:o(()=>[...e[33]||(e[33]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon","onClick"])]),i("div",ml,[(r(!0),v(U,null,E(n.library,(k,$,x)=>(r(),v("div",{key:x,class:"scantask-library-row"},[a(S,{"model-value":k.name?$:"","onUpdate:modelValue":b=>ue(l.name,$,b),onClick:b=>se(l.name),loading:q.value[l.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(r(!0),v(U,null,E(J.value[l.name],b=>(r(),V(y,{key:b.id,label:b.name,value:b.id,disabled:re(l.name,b.id,$)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","onClick","loading"]),a(m,{modelValue:k.crontab,"onUpdate:modelValue":b=>k.crontab=b,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input"},null,8,["modelValue","onUpdate:modelValue"]),a(s,{size:"small",type:"danger",icon:L(le),circle:"",onClick:b=>de(l.name,$)},null,8,["icon","onClick"])]))),128))])],64)):w("",!0)],2)):w("",!0)],64))),128))]),i("div",cl,[a(s,{type:"primary",onClick:n=>fe(l),loading:A.value[l.name]},{default:o(()=>[...e[34]||(e[34]=[C("保存配置",-1)])]),_:1},8,["onClick","loading"])])]),_:2},1032,["model"])])):X.value[l.name]?(r(),v("div",pl,[e[38]||(e[38]=i("div",{class:"error-text"},"加载失败",-1)),a(s,{type:"primary",round:"",onClick:n=>Y(l)},{default:o(()=>[...e[37]||(e[37]=[C(" 重新加载 ",-1)])]),_:1},8,["onClick"])])):(r(),v("div",vl,"加载配置中..."))])),[[Z,K.value[l.name]]]):w("",!0)]),_:2},1032,["class"]))),128))])),[[Z,O.value]]):w("",!0),a(Se,{modelValue:R.value,"onUpdate:modelValue":e[16]||(e[16]=l=>R.value=l),title:"添加服务器",width:"600px",center:"",class:"server-dialog"},{footer:o(()=>[a(s,{onClick:e[15]||(e[15]=l=>R.value=!1),disabled:G.value},{default:o(()=>[...e[43]||(e[43]=[C("取消",-1)])]),_:1},8,["disabled"]),a(s,{type:"primary",onClick:_e,loading:G.value},{default:o(()=>[...e[44]||(e[44]=[C("添加",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(me,{model:u.value,"label-width":"100px"},{default:o(()=>[a(p,{label:"服务器名称",required:""},{default:o(()=>[a(m,{modelValue:u.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.name=l),placeholder:"请输入服务器名称"},null,8,["modelValue"])]),_:1}),a(p,{label:"服务器类型",required:""},{default:o(()=>[a(S,{modelValue:u.value.type,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.type=l),placeholder:"选择服务器类型",class:"server-type-select"},{default:o(()=>[a(y,{label:"Plex",value:"plex"}),a(y,{label:"Emby",value:"emby"}),a(y,{label:"Jellyfin",value:"jellyfin"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"服务器地址",required:""},{default:o(()=>[i("div",yl,[i("div",fl,[T.value?(r(),V(z,{key:0,content:"选择协议类型",placement:"top"},{default:o(()=>[a(S,{modelValue:u.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.protocol=l),placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue"])]),_:1})):(r(),V(S,{key:1,modelValue:u.value.protocol,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.protocol=l),placeholder:"协议",class:"url-protocol"},{default:o(()=>[a(y,{label:"http",value:"http"}),a(y,{label:"https",value:"https"})]),_:1},8,["modelValue"])),e[39]||(e[39]=i("span",{class:"url-separator"},"://",-1))]),T.value?(r(),V(z,{key:0,content:"输入服务器地址，例如：localhost 或 192.168.1.100",placement:"top"},{default:o(()=>[a(m,{modelValue:u.value.host,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.host=l),placeholder:"地址",class:"url-host"},null,8,["modelValue"])]),_:1})):(r(),V(m,{key:1,modelValue:u.value.host,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.host=l),placeholder:"localhost 或 IP",class:"url-host"},null,8,["modelValue"])),i("div",kl,[e[40]||(e[40]=i("span",{class:"url-separator"},":",-1)),T.value?(r(),V(z,{key:0,content:"输入端口号（1-65535）",placement:"top"},{default:o(()=>[a(j,{modelValue:u.value.port,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value.port=l),min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue"])]),_:1})):(r(),V(j,{key:1,modelValue:u.value.port,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value.port=l),min:1,max:65535,placeholder:"端口",class:"url-port",controls:!1},null,8,["modelValue"]))])])]),_:1}),a(p,{label:"访问令牌"},{default:o(()=>[T.value?(r(),V(z,{key:0,content:"Plex 必须填写 X-Plex-Token，Emby/Jellyfin 填写 API Key",placement:"top"},{default:o(()=>[a(m,{modelValue:u.value.token,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.token=l),placeholder:"令牌"},null,8,["modelValue"])]),_:1})):(r(),V(m,{key:1,modelValue:u.value.token,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.token=l),placeholder:"Plex必填，emby / jellyfin选填Api key"},null,8,["modelValue"]))]),_:1}),a(p,{label:"用户名"},{default:o(()=>[a(m,{modelValue:u.value.username,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.username=l),placeholder:"可选"},null,8,["modelValue"])]),_:1}),a(p,{label:"密码"},{default:o(()=>[a(m,{modelValue:u.value.password,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.password=l),type:"password","show-password":"",placeholder:"可选"},null,8,["modelValue"])]),_:1}),u.value.type?(r(),v(U,{key:0},[e[42]||(e[42]=i("h4",{style:{"margin-top":"20px","margin-bottom":"16px"}},"任务配置",-1)),i("div",Vl,[(r(!0),v(U,null,E(u.value.tasks,(l,n)=>(r(),v("div",{key:n,class:W(["task-config-card",{"task-config-card-wide":n==="scantask"}])},[i("div",bl,P(oe(String(n))),1),a(p,{label:"是否启用"},{default:o(()=>[a(F,{modelValue:l.run,"onUpdate:modelValue":f=>l.run=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n!=="scantask"?(r(),V(p,{key:0,label:"Crontab"},{default:o(()=>[a(m,{modelValue:l.crontab,"onUpdate:modelValue":f=>l.crontab=f,size:"small",placeholder:"如: 0 0 * * *"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("",!0),n==="scantask"?(r(),v(U,{key:1},[i("div",_l,[a(s,{size:"small",type:"primary",icon:L(N),onClick:e[13]||(e[13]=f=>ne(u.value.name))},{default:o(()=>[...e[41]||(e[41]=[C(" 添加库扫描配置 ",-1)])]),_:1},8,["icon"])]),i("div",wl,[(r(!0),v(U,null,E(l.library,(f,k,$)=>(r(),v("div",{key:$,class:"scantask-library-row"},[a(S,{"model-value":f.name?k:"","onUpdate:modelValue":x=>ue(u.value.name,k,x),onClick:e[14]||(e[14]=x=>se(u.value.name)),loading:q.value[u.value.name],placeholder:"选择库",size:"small",class:"library-select"},{default:o(()=>[(r(!0),v(U,null,E(J.value[u.value.name],x=>(r(),V(y,{key:x.id,label:x.name,value:x.id,disabled:re(u.value.name,x.id,k)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","loading"]),a(m,{modelValue:f.crontab,"onUpdate:modelValue":x=>f.crontab=x,size:"small",placeholder:"输入Crontab表达式",class:"crontab-input"},null,8,["modelValue","onUpdate:modelValue"]),a(s,{size:"small",type:"danger",icon:L(le),circle:"",onClick:x=>de(u.value.name,k)},null,8,["icon","onClick"])]))),128))])],64)):w("",!0)],2))),128))])],64)):w("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Cl=Be(gl,[["__scopeId","data-v-520170e8"]]);export{Cl as default};
