import{d as q,r as i,m as H,n as J,p as K,c as h,o as _,b as e,w as t,e as n,s as P,E,q as Q,t as X,i as a,v as F,x as r,g as d,y as Y,z as Z,A as ee,B as R,C as se,D as te,j as ae,F as le,G as x,H as oe,I as ne,J as re,K as ce,_ as ue}from"./index-YOKk7ouR.js";const de={class:"dashboard"},ie={class:"card-header"},_e={class:"status-info"},me={class:"status-time"},ve={class:"card-header"},he={class:"status-info"},fe={class:"status-value"},ge={class:"status-label"},pe={class:"card-header"},ye={class:"status-info"},be={class:"status-value"},ke={class:"card-header card-header-with-action"},we={class:"header-title"},Ee={class:"card-header card-header-with-action"},Ie={class:"header-title"},Se={class:"logs-container"},Ne={class:"log-time"},Ce={class:"log-level"},De={class:"log-message"},Oe={key:0,class:"no-logs"},Le=q({__name:"Dashboard",setup(Fe){const c=i({status:"initializing",servers_count:0,failed_servers_count:0,active_tasks:0}),y=i(new Date().toISOString()),z=()=>({healthy:"正常",degraded:"部分失效",error:"错误",initializing:"初始化中"})[c.value.status]||"未知",A=()=>`status-${c.value.status}`,B=()=>{const{servers_count:s,failed_servers_count:l}=c.value;return l>0?`${s-l} 个正常 / ${l} 个失败`:`${s} 个服务器已连接`},b=i([]),f=i([]),k=i(!1),w=i(!1),T=s=>new Date(s).toLocaleString("zh-CN"),G=s=>{const l=/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) - ([^:]+:\d+) - (\w+) - (.+)$/,o=s.match(l);return o?{time:o[1].substring(11),module:o[2],level:o[3],message:o[4]}:{time:"",module:"",level:"",message:s}},$=s=>{switch(s){case"DEBUG":return"log-debug";case"INFO":return"log-info";case"WARNING":return"log-warning";case"ERROR":return"log-error";case"CRITICAL":return"log-critical";default:return"log-default"}},M=H(()=>f.value.map(s=>G(s))),I=async()=>{try{const s=await P.getStatus();c.value=s,y.value=new Date().toISOString()}catch(s){console.error("获取系统状态失败:",s),E.error("获取系统状态失败: "+s.message),c.value={status:"error",servers_count:0,failed_servers_count:0,active_tasks:0},y.value=new Date().toISOString()}},S=async()=>{k.value=!0;try{const s=await Q.getServers();b.value=s}catch(s){console.error("获取服务器列表失败:",s),E.error("获取服务器列表失败: "+s.message),b.value=[{name:"Demo Server",type:"plex",url:"http://localhost:32400",status:"disconnected"}]}finally{k.value=!1}},N=async()=>{w.value=!0;try{const s=await X.getLogs(20);f.value=s.logs.reverse()}catch(s){console.error("获取日志失败:",s),E.error("获取日志失败: "+s.message),f.value=["2025-10-07 00:00:01 - task.synctask:553 - ERROR - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行","2025-10-07 00:00:56 - task.synctask:446 - INFO - Emby(home) / Emby(rn)：开始同步进度","2025-10-07 00:01:01 - task.synctask:553 - WARNING - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行","2025-10-07 00:01:56 - task.synctask:446 - INFO - Emby(home) / Emby(rn)：开始同步进度","2025-10-07 00:02:03 - task.synctask:553 - INFO - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行","2025-10-07 00:02:56 - task.synctask:446 - DEBUG - Emby(home) / Emby(rn)：开始同步进度","2025-10-07 00:02:59 - task.synctask:553 - INFO - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行","2025-10-07 00:03:56 - task.synctask:446 - INFO - Emby(home) / Emby(rn)：开始同步进度","2025-10-07 00:04:00 - task.synctask:553 - CRITICAL - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行","2025-10-07 00:04:56 - task.synctask:446 - INFO - Emby(home) / Emby(rn)：开始同步进度","2025-10-07 00:05:08 - task.synctask:553 - INFO - Emby(home) / Emby(rn)：同步进度完毕，等待下一次运行"]}finally{w.value=!1}},U=async()=>{await I(),await S(),await N()};let g=null;return J(()=>{U(),g=setInterval(I,3e4)}),K(()=>{g!==null&&(clearInterval(g),g=null)}),(s,l)=>{const o=n("el-icon"),m=n("el-card"),v=n("el-col"),C=n("el-row"),D=n("el-button"),O=n("el-tooltip"),p=n("el-table-column"),V=n("el-tag"),W=n("el-table"),L=se("loading");return _(),h("div",de,[e(C,{gutter:20,class:"status-cards"},{default:t(()=>[e(v,{span:8},{default:t(()=>[e(m,{class:"status-card"},{header:t(()=>[a("div",ie,[e(o,{class:"card-icon"},{default:t(()=>[e(d(Y))]),_:1}),l[0]||(l[0]=a("span",null,"系统状态",-1))])]),default:t(()=>[a("div",_e,[a("div",{class:F(["status-value",A()])},r(z()),3),a("div",me," 上次更新："+r(T(y.value)),1)])]),_:1})]),_:1}),e(v,{span:8},{default:t(()=>[e(m,{class:"status-card"},{header:t(()=>[a("div",ve,[e(o,{class:"card-icon"},{default:t(()=>[e(d(Z))]),_:1}),l[1]||(l[1]=a("span",null,"媒体服务器",-1))])]),default:t(()=>[a("div",he,[a("div",fe,r(c.value.servers_count),1),a("div",ge,r(B()),1)])]),_:1})]),_:1}),e(v,{span:8},{default:t(()=>[e(m,{class:"status-card"},{header:t(()=>[a("div",pe,[e(o,{class:"card-icon"},{default:t(()=>[e(d(ee))]),_:1}),l[2]||(l[2]=a("span",null,"活跃任务",-1))])]),default:t(()=>[a("div",ye,[a("div",be,r(c.value.active_tasks),1),l[3]||(l[3]=a("div",{class:"status-label"},"个任务运行中",-1))])]),_:1})]),_:1})]),_:1}),e(C,{gutter:20,class:"content-row"},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(m,null,{header:t(()=>[a("div",ke,[a("div",we,[e(o,null,{default:t(()=>[e(d(le))]),_:1}),l[4]||(l[4]=a("span",null,"服务器列表",-1))]),e(O,{content:"刷新"},{default:t(()=>[e(D,{icon:d(x),circle:"",size:"small",onClick:S},null,8,["icon"])]),_:1})])]),default:t(()=>[R((_(),te(W,{data:b.value,style:{width:"100%"}},{default:t(()=>[e(p,{prop:"name",label:"名称",width:"100"}),e(p,{prop:"type",label:"类型",width:"80"}),e(p,{prop:"url",label:"地址","show-overflow-tooltip":""}),e(p,{prop:"status",label:"状态",width:"80"},{default:t(u=>[e(V,{type:u.row.status==="connected"?"success":"danger",size:"small"},{default:t(()=>[ae(r(u.row.status==="connected"?"已连接":"离线"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[L,k.value]])]),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(m,null,{header:t(()=>[a("div",Ee,[a("div",Ie,[e(o,null,{default:t(()=>[e(d(ce))]),_:1}),l[5]||(l[5]=a("span",null,"最近日志",-1))]),e(O,{content:"刷新"},{default:t(()=>[e(D,{icon:d(x),circle:"",size:"small",onClick:N},null,8,["icon"])]),_:1})])]),default:t(()=>[R((_(),h("div",Se,[(_(!0),h(ne,null,re(M.value,(u,j)=>(_(),h("div",{key:j,class:F(["log-item",$(u.level)])},[a("span",Ne,r(u.time),1),a("span",Ce,r(u.level),1),a("span",De,r(u.message),1)],2))),128)),f.value.length===0?(_(),h("div",Oe," 暂无日志记录 ")):oe("",!0)])),[[L,w.value]])]),_:1})]),_:1})]),_:1})])}}}),xe=ue(Le,[["__scopeId","data-v-699305b5"]]);export{xe as default};
